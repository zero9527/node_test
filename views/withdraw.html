<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" >
	<title>提现</title>
	<link rel="stylesheet" href="amazeui/css/amazeui.min.css">
	<link rel="stylesheet" href="iconfont/iconfont.css">
	<link rel="stylesheet" href="stylesheets/common.css">
	<link rel="stylesheet" href="stylesheets/withdraw.css">
</head>
<body>
	<div class='am-container' id='withdraw'>
		<div class='item'>
			<span class='fblue f6'>&nbsp;&nbsp;提现方式</span>
			<ul>
				<li class='cfix typeitem' @click='chooseway($event)' index='0'>
					<a>&emsp;提现到微信</a>
					<i class='iconfont icon-weixin fleft'></i>
					<span class='iconfont icon-empty fright'></span>
				</li>
				<li class='cfix typeitem' @click='chooseway($event)' index='1'>
					<a>&emsp;提现到支付宝</a>
					<i class='iconfont icon-alipay fleft'></i>
					<span class='iconfont icon-empty fright'></span>
				</li>
				<li class='cfix typeitem' @click='chooseway($event)' index='2'>
					<a>&emsp;提现到银行卡</a>
					<i class='ylpng fleft'><img src="images/yl.png" alt=""></i>
					<span class='iconfont icon-empty fright'></span>
				</li>
			</ul>
		</div>
		<div class='item'>
			<span class='fblue f6'>&nbsp;&nbsp;提现金额</span>
			<ul>
				<li class='inmoney'>
					<i class='iconfont icon-rmb'></i>
					<input class='money' type="text">
				</li>
				<li class='f6'>
					可提现 <span v-text='enmoney'></span>元,
					<a href="javascript:;" @click='withall' class='fblue'>全部提现</a>
				</li>
			</ul>
			<p class='desc fblue'><i class="am-icon-question-circle-o"></i>&nbsp;提现说明&nbsp;&nbsp;</p>
		</div>
		<button id='sure' @click='sure'>确定</button>
		<div class='withNext'>
			<p class='tcenter pTop'><i :class='payclass'></i></p>
			<div id='wxali'>
				<ul class='withpic'>
					<li>请上传&nbsp;<span style='color:#ff6666;'>收款二维码图片</span></li>
					<li>
						<i class='iconfont icon-add picadd'><span class='fblue'>添加</span></i>
					</li>
				</ul>
				<div>
					<p>如何添加，收款二维码？</p>
					<div class='f6'>
						<p>1、首先打开
							<span :class='paycolor' v-text='paytext1'></span>，存储二维码图片
						</p>
						<p>2、首页点击
							<span :class='paycolor' v-text='paytext2'></span>
						</p>
						<p>3、点击
							<span class='fblue'>"+"</span>，在相册中选取保存的二维码图片上传
						</p>
					</div>
				</div>
			</div>
			<div id='unionpay'>
				<div id='filter' :style='filterstyle'></div>
				<p class='uniontitle cfix' @click='selectunion' index='0'>
					<b>使用旧账号:</b>
					<span class='fright cfix'>
						<a style='color:#888;'>
							<span v-text='oldcard'></span>
							<span v-if='!oldcard' class='f6'>无历史账号记录</span>&nbsp;
						</a>
						<i class='iconfont icon-empty fright'></i>
					</span>
				</p>
				<ul>
					<li class='uniontitle cfix' @click='selectunion' index='1'>
						<b>添加新账号:</b>
						<i v-if='oldcard' class='iconfont icon-empty fright'></i>
						<i v-if='!oldcard' class='iconfont icon-select fright'></i>
					</li>
					<li class='unionitem cfix'>
						<span>开户名:</span>
						<input class='fright' type="text" placeholder="请输入开户名" v-model='uName'>
					</li>
					<li class='unionitem cfix'>
						<a>选择银行:</a>
						<span class='iconfont icon-xiangyou1 fright'></span>
						<span class='bankName'></span>
					</li>
					<li class='unionitem cfix'>
						<a>开户支行:</a>
						<span class='iconfont icon-xiangyou1 fright'></span>
						<span class='subBranch'></span>
					</li>
					<li class='unionitem cfix'>
						<span>银行卡号:</span>
						<input class='fright' type="text" placeholder="请输入银行卡号" v-model='cardNumber' @change='bankchange($event)'>
					</li>
				</ul>
			</div>
			<button id='nextSure' @click='nextSure'>提交</button>
		</div>
	</div>
	<script src="javascripts/vue.min.js"></script>
	<script src="javascripts/jquery.min.js"></script>
	<script src="amazeui/js/amazeui.min.js"></script>
	<script src="javascripts/public.js"></script>
	<script>
		var withdraw = new Vue({
			el: '#withdraw',
			data() {
				return {
					enmoney: '--',
					payway: '--',
					payclass: '--',
					paycolor: '--',
					paytext1: '--',
					paytext2: '--',
					hasPic: '--',			// 上传图片标志
					selectCard: '--',		// 选择银行卡标志
					filterstyle: '--',
					oldcard: null,			// 旧银行卡号
					uName: '',
					cardNumber: ''
				}
			},
			mounted() {	
				this.enmoney = '510.00';
				// this.oldcard = '3453463546456487';
				if(!this.oldcard){
					// 无旧银行卡时候使用
					this.filterstyle = 'display:block;';
					this.selectCard = 'new';	
				}
				// 获取提现方式，提现金额
				var href = location.href;
				var payway = '';
				var money = 0;
				if(href.indexOf('payway') > -1){
					payway = href.substring(href.indexOf('payway')+7, href.indexOf('&money'));
					money = href.substring(href.indexOf('&money=')+7);
					// 显示具体提现页面
					fadeFn({elem: $('.withNext')[0]});

					if(payway.indexOf('weixin') > -1){
						// 微信提现
						this.payway = 'weixin';
						this.payclass = 'iconfont icon-weixin';
						this.paycolor = 'fgreen';
						this.paytext1 = '\n微信';
						this.paytext2 = '"+" -- 收付款 -- 二维码收款 -- 保存收款码';
						document.title = '微信提现';
						$('#navbar>h2').text('微信提现');
						$('#wxali').show();

					}else if(payway.indexOf('alipay') > -1){
						// 支付宝提现
						this.payway = 'alipay';
						this.payclass = 'iconfont icon-alipay';
						this.paycolor = 'fblue';
						this.paytext1 = '\n支付宝';
						this.paytext2 = '"+" -- 收钱 -- 保存图片';
						document.title = '支付宝提现';
						$('#navbar>h2').text('支付宝提现');
						$('#wxali').show();

					}else if(payway.indexOf('unionpay') > -1){
						// 银行卡提现
						this.payway = 'unionpay';
						this.payclass = 'ylpng';
						$('.withNext>p>i').html('<img src="images/yl.png" alt="">');
						document.title = '银行卡提现';
						$('#navbar>h2').text('银行卡提现');
						$('#unionpay').show();
					}

				}
				// console.log(payway, money);
				
			},
			methods: {
				// 点击全部提现
				withall: function(){
					$('.money').val(this.enmoney);
				},
				// 点击选择提现方式
				chooseway: function(e){
					for(var i=0; i<$('.typeitem').length; i++){
						$('.typeitem').eq(i)
						.find('span').attr('class','iconfont icon-empty fright');
					}
					this.payway = e.currentTarget.getAttribute('index');	//保存当前选择方式
					if(this.payway == 0){
						this.payway = 'weixin';	// 微信

					}else if(this.payway == 1){
						this.payway = 'alipay';	// 支付宝

					}else if(this.payway == 2){
						this.payway = 'unionpay';	// 银联
						
					}
					var span = e.currentTarget.getElementsByTagName('span');
					var _class = 'iconfont icon-select fright';

					span[0].setAttribute('class',_class);
				},
				// 点击确定
				sure: function(){
					var chooseway = $('.icon-select');
					var money = $('.money').val();
					var numReg = /[0-9\.]/;

					if(!chooseway.length){
						noticeFn({text: '请选择提现方式！'});
						return 
					}
					if(!trimFn(money)){
						noticeFn({text: '请输入提现金额！'});
						return

					}else if(!numReg.test(trimFn(money))){
						noticeFn({text: '请输入阿拉伯数字（0-9）金额！'});
						return

					}else if(Number(trimFn(money)) > this.enmoney){
						noticeFn({text: '提现金额超出最大值！'});
						return
					}
					// 跳转到下一个页面 (弹出相关方式)
					var locahref = location.href;
					//清除url查询字
					if(locahref.indexOf('?') > -1){
						locahref = locahref.substring(0, locahref.indexOf('?'));
					}
					var href = locahref + '?payway=' + this.payway + '&money=' + money;
					location.href = href;
					// console.log(this.payway, money);
				},
				// 选择旧账号或添加银行卡
				selectunion: function(e){
					var index = e.currentTarget.getAttribute('index');
					var card = $('.uniontitle').find('i');
					var check = e.currentTarget.getElementsByTagName('i');
					check[0].setAttribute('class','iconfont icon-select fright');

					if(index == 0){
						// 旧账号
						this.selectCard = 'old';
						card[1].setAttribute('class','iconfont icon-empty fright');

					}else if(index == 1){
						// 添加新账号
						this.selectCard = 'new';
						card[0].setAttribute('class','iconfont icon-empty fright');
						
					}
				},
				// 银行卡号每四个加空格
				bankchange: function(e){
					console.log(e);
					this.cardNumber = this.cardNumber.replace(/(\d)(?=(?:\d{4})+$)/g, '$1 ');
					console.log(this.cardNumber);
				},
				// 点击提交
				nextSure: function(){
					switch(this.payway){
						case 'weixin':
							// 微信支付
							break;

						case 'alipay':
							// 支付宝
							break;

						case 'unionpay':
							// 银行卡
							if(this.selectCard == 'new'){
								//添加新银行卡
								console.log(bankCheck(trimFn(this.cardNumber)));
							}else if(this.selectCard == 'old'){
								// 使用旧账户
								
							}
							break;

						default:
							console.log('错误');
							break;
					}
					console.log(this.uName, this.cardNumber);

				}
			},
			watch: {}
		})
	</script>
</body>
</html>